<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Journal Entry</title>
        <link rel="stylesheet" href="/styles.css" />
    </head>
    <body>
        <header class="header-bar">
            <nav class="nav-left">
                <a href="/index.html" class="nav-link">HOME</a>
                <a href="/log-a-trade.html" class="nav-link">LOG A TRADE</a>
                <a href="/journal.html" class="nav-link">JOURNAL</a>
            </nav>
        </header>

        <main class="container">
            <div id="entryDetails">
                <p>Loading...</p>
            </div>
        </main>

        <script>
            document.addEventListener("DOMContentLoaded", async () => {
                const id = window.location.pathname.split("/").pop();

                const container = document.getElementById("entryDetails");

                if (!id) {
                    container.innerHTML = "<p>No entry ID provided.</p>";
                    return;
                }

                try {
                    const res = await fetch(`/api/trades/${id}`);
                    const trade = await res.json();

                    const profit =
                        trade.exitPrice && trade.entryPrice && trade.quantity
                            ? (
                                  (trade.exitPrice - trade.entryPrice) *
                                  trade.quantity
                              ).toFixed(2)
                            : "N/A";

                    container.innerHTML = `
                        <h1>${trade.symbol} (${trade.companyName || ""})</h1>
                        <p><strong>Trade Type:</strong> ${trade.tradeType}</p>
                        <p><strong>Entry Price:</strong> $${
                            trade.entryPrice
                        }</p>
                        <p><strong>Exit Price:</strong> $${trade.exitPrice}</p>
                        <p><strong>Quantity:</strong> ${trade.quantity}</p>
                        <p><strong>Profit:</strong> $${profit}</p>
                        <p><strong>Entry Date:</strong> ${new Date(
                            trade.entryDate
                        ).toLocaleDateString()}</p>
                        <p><strong>Exit Date:</strong> ${
                            trade.exitDate
                                ? new Date(trade.exitDate).toLocaleDateString()
                                : "—"
                        }</p>
                        <p><strong>Stop Loss:</strong> ${
                            trade.stopLoss ?? "—"
                        }</p>
                        <p><strong>Take Profit:</strong> ${
                            trade.takeProfit ?? "—"
                        }</p>
                        <p><strong>Notes:</strong><br/>${
                            trade.notes || "None"
                        }</p>
                    `;
                } catch (err) {
                    console.error("Error loading trade:", err);
                    container.innerHTML =
                        "<p>Failed to load journal entry. Try again later.</p>";
                }
            });
        </script>
    </body>
</html>
